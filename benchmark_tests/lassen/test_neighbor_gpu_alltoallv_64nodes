#!/bin/bash
#BSUB -J nbralltoallv_n64
#BSUB -e nbralltoallv_n64.%J.err
#BSUB -o nbralltoallv_n64.%J.out
#BSUB -nnodes 64
#BSUB -q pbatch
#BSUB -W 03:50

module load gcc/7.3.1
module load cuda/10.2.89
module load hwloc

cd $HOME/locality_aware-mikethebos/build/benchmarks

echo "Running Unthreaded Neighbor_Alltoallv Test:"
export OMP_NUM_THREADS=1
jsrun -a4 -c4 -g4 -r1 -n64 -M "-gpu" --latency_priority=gpu-cpu --launch_distribution=packed ./gpu_neighbor_alltoallv

echo "Running Threaded Neighbor_Alltoallv Test with 2 threads:"
export OMP_NUM_THREADS=2
jsrun -a4 -c8 -g4 -r1 -n64 -M "-gpu" --latency_priority=gpu-cpu --launch_distribution=packed ./gpu_threaded_neighbor_alltoallv

echo "Running Threaded Neighbor_Alltoallv Test with 4 threads:"
export OMP_NUM_THREADS=4
jsrun -a4 -c16 -g4 -r1 -n64 -M "-gpu" --latency_priority=gpu-cpu --launch_distribution=packed ./gpu_threaded_neighbor_alltoallv

echo "Running Threaded Neighbor_Alltoallv Test with 8 threads:"
export OMP_NUM_THREADS=8
jsrun -a4 -c32 -g4 -r1 -n64 -M "-gpu" --latency_priority=gpu-cpu --launch_distribution=packed ./gpu_threaded_neighbor_alltoallv
